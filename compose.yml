services:
  ynym-portal-gateway:
    image: steveltn/https-portal:1.24.0
    container_name: ynym-portal-gateway
    hostname: ynym-portal-gateway
    restart: always
    environment:
      - STAGE=production
      - DOMAINS="api-portal.uryonym.com -> http://ynym-portal-backend:3000"
    ports:
      - 443:443
    depends_on:
      - ynym-portal-backend
    volumes:
      - ynym-portal-gateway-volume:/var/lib/https-portal

  ynym-portal-backend:
    build: .
    image: ynym-portal-backend
    container_name: ynym-portal-backend
    hostname: ynym-portal-backend
    command: /bin/bash -c "rm -f tmp/pids/server.pid && bundle exec rails s"
    restart: always
    environment:
      - TZ=Asia/Tokyo
      - RAILS_ENV=production
    volumes:
      - ./log:/app/log

networks:
  default:
    name: ynym-portal-network
    external: true
